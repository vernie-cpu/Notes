# 相关概念

## IP地址

IP地址是[IP协议](https://baike.baidu.com/item/IP协议/131947)提供的一种统一的[地址格式](https://baike.baidu.com/item/地址格式/53569124)，它为互联网上的每一个网络和每一台[主机](https://baike.baidu.com/item/主机/455151)分配一个[逻辑地址](https://baike.baidu.com/item/逻辑地址/3283849)，以此来屏蔽[物理地址](https://baike.baidu.com/item/物理地址/2901583)的差异。



### 公网和私网

**公网：**

指以公网连接Internet上的非保留地址。由InterNIC负责。这些IP地址分配给注册并向InterNIC提出申请的组织机构。通过直接访问互联网。全世界公网IP是唯一的，在Internet上的其他计算机可以随意地相互访问。

**私网：**

是在本地局域网上的IP。私有网络地址不能出现在公共网络上，只能在内部网络中使用。所有路由器不能发送目标地址为私有网络地址的数据报。内部IP地址必须通过NAT转换成公网上可用的IP地址，才能实现内部IP地址与外部公网的通信。随着私有IP网络的发展，为节省可分配的注册IP地址，有一组IP地址被拿出来专门用于私有IP网络。我们从三个主要类型的IP地址里，各保留了一个区域作为私有地址的专用网络，详见 IP地址分类。



### IP地址分类

IP地址由四段组成，每个字段是一个字节，8位，最大值是255。

IP地址由两部分组成，即 网络地址 和 主机地址 。网络地址表示其属于互联网的哪一个网络，主机地址表示其属于该网络中的哪一台主机。二者是主从关系。

> 网络地址（Network address）是互联网上的节点在网络中具有的逻辑地址，可对节点进行寻址。拥有相同 网络地址 的主机，表示他们在同一网段；
>
> 主机地址 就是当前 主机在网段中的逻辑地址。

IP地址的四大类型标识的是网络中的某台主机。IPv4的地址长度为32位，共4个字节，但实际中我们用[点分十进制](http://baike.baidu.com/view/828066.htm)记法。

<img src="./images/operationsystem_002.png" style="float: left;width: 50%;">



**IP地址根据网络号和主机号来分，分为A、B、C三类及特殊地址D、E。  全0和全1的都保留不用。**

- **A类：**

  (1.0.0.0-126.0.0.0)（默认子网掩码：255.0.0.0或 0xFF000000）第一个字节为网络号，后三个字节为主机号。该类IP地址的最前面为“0”，所以地址的 网络号 取值于**1~126**之间。一般用于大型网络。

  **网络地址取值分析：**

  1. 网络号最小值：0000 0001 => 1，因为全0保留不用；
  2. 网络号最大值：0111 1111 => 127，但是这里还有一个特殊点，那就是 127 网络号也是为专用保留的，比如本机地址：127.0.0.1，所以这里最大值只能取到 126。

- **B类：**

  (128.0.0.0-191.255.0.0)（默认子网掩码：255.255.0.0或0xFFFF0000）前两个字节为网络号，后两个字节为主机号。该类IP地址的最前面为“10”，所以地址的网络号取值于**128~191**之间。一般用于中等规模网络。

  **网络地址取值分析：**

  1. 网络号最小值：1000 0000 0000 0000 => 128.0  。
  2. 网络号最大值：1011 1111 1111 1111=> 191.255  。

- **C类：**

  (192.0.0.0-223.255.255.0)（子网掩码：255.255.255.0或 0xFFFFFF00）前三个字节为网络号，最后一个字节为主机号。该类IP地址的最前面为“110”，所以地址的网络号取值于**192~223**之间。一般用于小型网络。

  **网络地址取值分析：**

  ​	同上。

- **D类：**

  是多播地址。该类IP地址的最前面为“1110”，所以地址的网络号取值于224~239之间。一般用于多路广播用户。

- **E类：**

  是保留地址。该类IP地址的最前面为“1111”，所以地址的网络号取值于240~255之间。



**在IP地址3种主要类型里，各保留了1个区域作为私有地址，其地址范围如下： **

- A类地址：10.0.0.0～10.255.255.255 
- B类地址：172.16.0.0～172.31.255.255 
- C类地址：192.168.0.0～192.168.255.255



**回送地址：**

127.0.0.1。 也是本机地址，等效于localhost或本机IP。一般用于测试使用。例如：ping 127.0.0.1来测试本机TCP/IP是否正常。



**总结：**

| 类别 | 最大网络数    | IP地址范围                | 单个网段最大主机数 | 私有IP地址范围              |
| ---- | ------------- | ------------------------- | ------------------ | --------------------------- |
| A    | 126(2^7-2)    | 1.0.0.1-126.255.255.254   | 16777214           | 10.0.0.0-10.255.255.255     |
| B    | 16384(2^14)   | 128.0.0.1-191.255.255.254 | 65534              | 172.16.0.0-172.31.255.255   |
| C    | 2097152(2^21) | 192.0.0.1-223.255.255.254 | 254                | 192.168.0.0-192.168.255.255 |

单个网段最大主机个数解析（用A类举例）：

> 一个A类主机地址：121.4.47.229

1. 在一个网段中，将主机号全为0（二进制）的IP地址保留不用，用来表示一个网络地址。这里的 网络地址：121.0.0.0 ；
2. 同时，还将 主机号全为1（二进制）的IP地址作为广播号，即在网络寻址的时候发送广播包的目的IP地址，这个广播号可以让同网段的所有主机都收到广播包。这里的 广播号：121.255.255.255。

所以，最大主机个数：256 * 256 * 256 - 2 = 16777214。





## 网关

网关实质上是一个网络通向其他网络的 IP地址。网关也被称为 IP路由器。

PC本身不具备路由寻址能力，所以PC要把所有的IP包发送到一个默认的中转地址上面进行转发，也就是默认网关。这个网关可以在路由器上，可以在三层交换机上，可以在防火墙上，可以在服务器上，所以和物理的设备无关。

比如：

​		有网络A和网络B，网络A的IP地址范围为“192.168.1.1~192. 168.1.254”，子网掩码为255.255.255.0；网络B的IP地址范围为“192.168.2.1~192.168.2.254”，子网掩码为255.255.255.0。在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机（或集线器）上，TCP/IP协议也会根据子网掩码（255.255.255.0）与主机的IP 地址作 “与” 运算的结果不同判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则必须通过网关。如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。



**常见WEB网关接口：**

- **CGI（Common Gateway Interface，通用网关接口）：**

  定义客户端与Web服务器的交流方式的一个程序，例如正常情况下客户端发送过来一个请求，根据HTTP协议Web服务器将请求的内容解析出来，经过处理会后，再将返回的内容封装好。例如服务器返回一个HTML页面，并且根据HTTP协议构建返回内容的响应格式，涉及到TCP连接、HTTP原始请求和相应格式都是由一个软件来完成，这个程序就是CGI。

- **WSGI（Python Web Server Gateway Interface，WSGI）：**

  Web服务器网关接口，是为Python语言定义的Web服务器和Web应用程序或框架之间的联系，一个简单而且通用的接口， 从语义上理解，WSGI为了解决Web服务器与客户端之间的通信问题而产生的。并且WSGI是基于现存的CGI标准而设计的。

- **ASGI：**

  是异步网关协议接口,介于网络服务和python应用之间的标准接口,能够处理多种通用的协议类型,包括http,http2和websocket。

- **WSGI和ASGI的区别：**

  WSGI是基于http协议模式开发的,不支持websocket,而ASGI的诞生解决了python中的WSGI不支持当前的web开发中的一些新的协议标准,同时ASGI支持原有模式和Websocket的扩展, 即ASGI是WSGI的扩展.

- **uWSGI:**

  uWSGI是一个Web服务器，它实现了WSGI协议、uwsgi、http等协议。Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换。

  要注意 WSGI / uwsgi / uWSGI 这三个概念的区分。

  - WSGI是一种通信协议。
  - uwsgi是一种线路协议而不是通信协议，在此常用于在uWSGI服务器与其他网络服务器的数据通信。
  - 而uWSGI是实现了uwsgi和WSGI两种协议的Web服务器。

  uwsgi协议是一个uWSGI服务器自有的协议，它用于定义传输信息的类型（type of information），每一个uwsgi packet前4byte为传输信息类型描述，它与WSGI相比是两样东西。



## 子网掩码

子网掩码(subnet mask)又叫 网络掩码 、地址掩码 、子网络遮罩，它用来指明一个 IP地址 的哪些位标识的是 主机 所在的子网，以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成 **网络地址** 和 **主机地址** 两部分。

子网掩码是一个32位地址，用于屏蔽IP地址的一部分以区别网络标识和主机标识，并说明该IP地址是在[局域网](https://baike.baidu.com/item/局域网/98626)上，还是在[广域网](https://baike.baidu.com/item/广域网/422004)上。

| 类别 | 子网掩码的二进制数值                | 子网掩码的十进制数值 |
| ---- | ----------------------------------- | -------------------- |
| A    | 11111111 00000000 00000000 00000000 | 255.0.0.0            |
| B    | 11111111 11111111 00000000 00000000 | 255.255.0.0          |
| C    | 11111111 11111111 11111111 00000000 | 255.255.255.0        |

子网掩码一定是配合IP地址来使用的。对于常用网络A、 B、C 类IP地址其默认子网掩码的二进制与十进制对应关系如表1所示。子网掩码工作过程是：将32位的 子网掩码 和 IP地址 二进制进行逻辑“与”（&）运算，得到的就是主机地址。如：192.168.10.11 & 255.255.255.0，结果为192.168.10.0（网络地址），其表达的含义为：该IP地址属于 192.168.10.0这个网络，其主机号为11（主机地址），即该主机在这个网络中编号为11。



**CIDR表示掩码：**

IP地址/ 掩码中1的个数。

例：192.168.1.10/24 就表示该IP的子网掩码中有24个1，就是一个标准的C类IP。



**子网划分：**

子网划分的目的是为了充分利用网段IP，当一个网段中只能使用部分IP时，就可以将当前网段划分为多个子网段。

子网划分内容较多，详见一个优秀的博客：https://blog.51cto.com/u_6930123/2113151



## 网络通信

正常情况下，主机之间要完成相互通信，两台主机必须要在同一网段中。如果两台主机不在同一网段，那么需要 路由器 转发才能完成通信。

判断 两台主机 是否在同一网段的标准：**两台主机的 网络地址 相同**。

**注意**：当 源主机 判断 目标主机 是否跟自己 在同一网段时，计算 目标主机 的 网络地址时，使用的是自己的 子网掩码 和 目标IP 进行 与 运算。

**示例：**

```shell
# 两台主机信息
192.168.0.10/24  		# 主机1。子网掩码：255.255.255.0
192.168.10.10/16		# 主机2。子网掩码：255.255.0.0

# ！！！ 错误逻辑 计算 网络地址。 就是 都用各自的 掩码 来计算。
192.168.0.10 & 255.255.255.0 => 192.168.0.0 # 主机1的网络地址
192.168.10.10 & 255.255.0.0 => 192.168.0.0 # 主机2的网络地址
## 上面的计算逻辑，这两台主机是可以直接通信的。但事实并非如此。


# 当 主机1 向 主机2 发送数据时，由 主机1 校验 网络地址。
192.168.0.10 & 255.255.255.0 => 192.168.0.0 # 主机1的网络地址
192.168.10.10 & 255.255.255.0 => 192.168.10.0 # 主机2的网络地址
## 可见 二者网络地址是不相同的，也就不能完成通信。


# 当 主机2 向 主机1 发送数据时，由 主机2 校验 网络地址。
192.168.0.10 & 255.255.0.0 => 192.168.0.0 # 主机1的网络地址
192.168.10.10 & 255.255.0.0 => 192.168.0.0 # 主机2的网络地址
## 可见 此时二者的网络地址相同，可以由 主机2 向 主机1 发送数据包；但当 主机1 想回发时，会发现网络地址是不一样的，也就会导致 主机2 收不到 主机1 的会送。因此在这种情况下，二者仍然是不能建立通信的。
```





## MAC地址

**MAC地址**（**英语：Media Access Control Address）**，直译为**媒体存取控制位址**，也称为**局域网地址**（LAN Address），**MAC位址**，**以太网地址**（Ethernet Address）或**物理地址**（Physical Address），它是一个用来确认网络设备位置的位址。**在 OSI模型 中，第三层网络层负责 IP地址 ，第二层数据链路层则负责 MAC位址。**MAC地址用于在网络中唯一标示一个 网卡，一台设备若有一或多个网卡，则每个网卡都需要并会有一个唯一的MAC地址。

MAC地址也叫物理地址、硬件地址，由网络设备制造商生产时烧录在网卡(Network lnterface Card)的[EPROM](https://baike.baidu.com/item/EPROM/1690813)(一种闪存芯片，通常可以通过程序擦写)。IP地址 与 MAC地址 在计算机里都是以 二进制 表示的，IP地址是32位的，而MAC地址则是48位的。

MAC地址的长度为48位(6个字节)，通常表示为12个16进制数，如：00-16-EA-AE-3C-40就是一个MAC地址，其中前3个字节，16进制数00-16-EA代表网络硬件制造商的编号，它由[IEEE](https://baike.baidu.com/item/IEEE/150905)(电气与电子工程师协会)分配，而后3个字节，16进制数AE-3C-40代表该制造商所制造的某个网络产品(如网卡)的系列号。只要不更改自己的MAC地址，MAC地址在世界是唯一的。形象地说，MAC地址就如同身份证上的身份证号码，具有唯一性。

**如果目的地址是：FF-FF-FF-FF-FF-FF，则表示当前数据包是一个广播包，广播包的作用主要就是 用 RARP、ARP两种协议查找目标IP的MAC地址。**



## 冲突域

冲突域是在同一个网络上两个比特同时进行传输则会产生冲突；在网路内部数据分组所产生与发生冲突的这样一个区域称为冲突域，所有的 共享介质 环境都是一个冲突域，在共享介质环境中一定类型的冲突域是正常行为。

用网桥划分多个缆段，多个缆段之间没有冲突，但一个缆段中有冲突（各个缆段中用HUB连接），一个缆段中的一个冲突是一个冲突域，一个冲突域（即同一缆段中的）都能收到所有被发送的帧，因为HUB是完全复制的。

对网络进行分段的原因是：分离流量并创建更小的冲突域来使用户获得更高的 带宽，否则网络很快会被流量所阻塞，**冲突域就是连接在同一导线上的所有工作站的集合**，或者说是同一物理 网段 上所有节点的集合，或 以太网 上竞争同一 带宽 的节点集合。

冲突域 是基于第一层（[物理层](https://baike.baidu.com/item/物理层)）。



## 广播域

广播是一种信息的传播方式，指网络中的某一设备同时向网络中所有的其它设备发送数据，这个数据所能广播到的范围即为广播域(Broadcast Domain)。

简单点说，广播域就是指网络中所有能接收到同样广播消息的设备的集合。而能接收到同样广播消息的设备一定是同一网段的设备。

广播域 是基于第二层（[链路层](https://baike.baidu.com/item/链路层)）。





# 网络设备

## 网卡

网卡是一块被设计用来允许计算机在计算机网络上进行通讯的计算机硬件。由于其拥有 MAC地址，因此属于 OSI模型 的第1层和2层之间。它使得用户可以通过电缆或无线相互连接。

每一个网卡都有一个被称为MAC地址的独一无二的48位串行号，它被写在卡上的一块 ROM 中。在网络上的每一个计算机都必须拥有一个独一无二的MAC地址。

**主要功能：**

1. 数据的封装与解封

   发送时将上一层传递来的数据加上首部和尾部，成为以太网的帧。接收时将以太网的帧剥去首部和尾部，然后送交上一层

2. 链路管理

   主要是通过[CSMA/CD](https://baike.baidu.com/item/CSMA%2FCD)（Carrier Sense Multiple Access with Collision Detection ，带[冲突检测](https://baike.baidu.com/item/冲突检测)的[载波监听多路访问](https://baike.baidu.com/item/载波监听多路访问)）协议来实现

3. 数据编码 与 译码

   即[曼彻斯特编码](https://baike.baidu.com/item/曼彻斯特编码)与译码。其中曼彻斯特码，又称数字双向码、相位编码(PE)，是一种常用的二元码线路编码方式之一，被 物理层 使用来编码一个同步位流的时钟和数据。在通信技术中，用来表示所要发送比特 流中的数据与定时信号所结合起来的代码。 常用在 以太网 通信，列车总线控制，工业总线等领域。



## 网线

网线，一般由金属或玻璃制成，它可以用来在网络内传递信息。常用的网络电缆有三种：**双绞线**、**同轴电缆**和**光纤电缆（光纤）**。双绞线是由许多对线组成的数据传输线。它的特点是价格便宜，所以被广泛应用。双绞线是用来和RJ45水晶头相连的，有STP和UTP两种，常用的是UTP。

- **双绞线**

  双绞线（Twisted pair）分为屏蔽（Shielded Twisted pair，简称STP）和非屏蔽（Unshielded Twisted pair，简称UTP）两种。所谓的屏蔽就是指网线内部信号线的外面包裹着一层金属网，在屏蔽层外面才是绝缘外皮，屏蔽层可以有效地隔离外界电磁信号的干扰。

  UTP是目前局域网中使用频率最高的一种网线。这种网线在塑料绝缘外皮里面包裹着8根信号线，它们每两根为一对相互缠绕，总共形成四对，双绞线也因此得名。双绞线这样互相缠绕的目的就是利用铜线中电流产生的电磁场互相作用抵消邻近线路的干扰并减少来自外界的干扰。每对线在每英寸长度上相互缠绕的次数决定了抗干扰的能力和通信的质量，缠绕得越紧密其通信质量越高，可以支持更高的网络数据传送速率，当然它的成本也就越高。

  

- **同轴电缆**

  同轴电缆（Coaxial Cable）是指有两个同心导体，而导体和屏蔽层又共用同一轴心的电缆。由于它在主线外包裹绝缘材料，在绝缘材料外面又有一层网状编织的屏蔽金属网线，所以能很好地阻隔外界的电磁干扰，提高通信质量。

  同轴电缆的优点是可以在相对长的无中继器的线路上支持高带宽通信，而其缺点也是显而易见的：一是体积大，细缆的直径就有3/8英寸粗，要占用电缆管道的大量空间；二是不能承受缠结、压力和严重的弯曲，这些都会损坏电缆结构，阻止信号的传输；三是成本高。而所有这些缺点正是双绞线能克服的，因此在现在的局域网环境中，基本已被基于双绞线的以太网物理层规范所取代。同轴电缆分为细缆和粗缆两种。



- **光纤**

  光纤（Fiber Optic Cable）以光脉冲的形式来传输信号，因此材质也以玻璃或 有机玻璃 为主。它由纤维芯、包层和保护套组成。

  光纤的结构和同轴电缆很类似，也是中心为一根由玻璃或透明塑料制成的光导纤维，周围包裹着保护材料，根据需要还可以多根光纤并合在一根光缆里面。根据光信号发生方式的不同，光纤可分为单模光纤和多模光纤。



## 中继器

中继器（RP repeater）是工作在 物理层 上的连接设备。适用于完全相同的两个网络的互连，主要功能是通过对数据信号的重新发送或者转发，来扩大网络传输的距离。

中继器是 局域网 环境下用来延长网络距离的，但是它属于 网络互联设备，操作在OSI的物理层，中继器对在线路上的信号具有放大再生的功能，用于扩展局域网[网段](https://baike.baidu.com/item/网段/11026985)的长度（仅用于连接相同的局域网网段）。



## 集线器（HUB）

**集线器** 的英文称为`Hub`。`Hub`是“中心”的意思，集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。

`Hub` 工作于OSI参考模型第一层，即“物理层”。集线器与网卡、网线等传输介质一样，属于局域网中的基础设备，采用 CSMA/CD（即带冲突检测的载波监听多路访问技术)介质访问控制机制。**集线器每个接口简单的收发比特，收到1就转发1，收到0就转发0，不进行碰撞检测。**

集线器（hub）属于 **纯硬件** 网络底层设备，不具有类似于交换机的 "智能记忆" 能力和 "学习" 能力。也不具备交换机所具有的MAC地址表，所以<font color="red">它发送数据时都是没有针对性的，而是采用广播方式发送。也就是说当它要向某节点发送数据时，不是直接把数据发送到目的节点，而是把数据包发送到与集线器相连的所有节点。</font>

HUB是一个多端口的转发器，当以HUB为中心设备时，网络中某条线路产生了故障，并不影响其它线路的工作。所以HUB在局域网中得到了广泛的应用。大多数的时候它用在星型与树型网络拓扑结构中，以RJ45接口与各主机相连（也有[BNC接口](https://baike.baidu.com/item/BNC接口)）。



## 网桥

网桥（Bridge）是 **早期** 的两端口二层网络设备。网桥的两个端口分别有一条独立的交换信道，不是共享一条背板总线，可隔离冲突域。网桥比集线器（Hub）性能更好，集线器上各端口都是共享同一条背板总线的。**后来，网桥被具有更多端口、同时也可隔离冲突域的交换机（Switch）所取代。**

网桥（Bridge）像一个聪明的中继器。中继器从一个网络电缆里接收信号，放大它们，将其送入下一个电缆。相比较而言，网桥对从关卡上传下来的信息更敏锐一些。网桥是一种对 **帧** 进行转发的技术，根据MAC分区块，可隔离碰撞。网桥将网络的同一网段在[数据链路层](https://baike.baidu.com/item/数据链路层/4329290)连接起来，只能连接同构网络(同一网段)，不能连接异构网络（不同网段）。

网桥也叫桥接器，是连接两个局域网的一种存储/转发设备，它能将一个大的LAN分割为多个网段，或将两个以上的LAN互联为一个逻辑LAN，使LAN上的所有用户都可访问服务器。

扩展局域网最常见的方法是使用网桥。最简单的网桥有两个端口，复杂些的网桥可以有更多的端口。网桥的每个端口与一个网段相连。



## 交换机

交换机（Switch）意为 “ 开关 ” 是一种用于电（光）信号转发的 网络设备。它可以为接入交换机的任意两个 网络节点 提供独享的电信号通路。最常见的交换机是 **以太网交换机**。其他常见的还有电话语音交换机、光纤交换机 等。

交换机工作于OSI参考模型的 第二层，即 [数据链路层](https://baike.baidu.com/item/数据链路层)。交换机内部的CPU会在每个端口成功连接时，通过将MAC地址和端口对应，形成一张MAC表。在今后的通讯中，发往该MAC地址的数据包将仅送往其对应的端口，而不是所有的端口。因此，**交换机可用于划分数据链路层广播，即冲突域；但它不能划分网络层广播，即广播域。**

**交换机工作原理：**

1. 交换机拥有一条很高 带宽 的背部 **总线** 和内部 **交换矩阵**。交换机的所有的端口都挂接在这条背部总线上，控制电路收到数据包以后，处理端口会查找内存中的地址对照表以确定 目的MAC地址（[网卡](https://baike.baidu.com/item/网卡)的硬件地址）的[NIC](https://baike.baidu.com/item/NIC)（网卡）挂接在哪个端口上，通过内部交换矩阵迅速将数据包传送到目的端口，**目的MAC地址 若不存在，则先广播到所有的端口，接收端口回应后交换机会“学习”新的MAC地址，并把它添加入内部MAC地址表中。**
2. 使用交换机也可以把网络“分段”，通过对照IP地址表，交换机只允许必要的 网络流量 通过交换机。通过交换机的过滤和转发，可以有效的减少冲突域。即交换机可以将两个不同网段的局域网隔离开来，不会允许一个网段的数据包发送到另一个网段。



**交换机的特点：**

1. 以太网交换机的每个端口都直接与主机相连，并且通信一般都采用 全双工方式。
2. 交换机能同时连通许多对的端口，使每一对相互通信的主机都能像独占通信媒体那样，进行无冲突地传输数据。
3. 用户独占传输媒体的带宽，若一个接口到主机的带宽是10Mbit每秒，那么有10个接口的交换机的总容量是100Mbit每秒。这是交换机的最大优点。



## 路由器

路由器（Router）是连接两个或多个网络（一个网段组成的局域网理解为一个网络）的硬件设备，在网络间起**网关**的作用，是读取每一个数据包中的地址然后决定如何传送的专用智能性的网络设备。

路由器又可以称之为网关设备。路由器就是在OSI/RM中完成的[网络层](https://baike.baidu.com/item/网络层/4329439)中继以及第三层中继任务，对不同的网络之间的[数据包](https://baike.baidu.com/item/数据包/489739)进行存储、分组转发处理，其主要就是在不同的逻辑分开网络。

**原理：**

网络中的设备相互通信主要是用它们的 IP地址，路由器只能根据具体的IP地址来转发数据。

IP地址由网络地址和主机地址两部分组成。在Internet中采用的是由子网掩码来确定网络地址和主机地址。

子网掩码与IP地址一样都是32位的，并且这两者是一一对应的，子网掩码中 `1` 对应IP地址中的网络地址，`0` 对应的是主机地址，网络地址和主机地址就构成了一个完整的IP地址。

在同一个网络中，IP地址的**网络地址必须是相同的（这就是同一个网段）**。计算机之间的通信只能在具有相同 网络地址 的IP地址之间进行，如果想要与其他网段的计算机进行通信，则必须经过路由器转发出去。不同网络地址的IP地址是不能直接通信的，即便它们距离非常近，也不能进行通信。

路由器的多个端口可以连接多个网段，<font color="red">**路由器的 每个端口的IP地址的 网络地址 都必须与所连接的 网段 的网络地址一致（路由器的端口也是有 IP地址的）。**</font>不同的端口它的网络地址是不同的，所对应的网段也是不同的，这样才能使各个网段中的主机通过自己网段的IP地址把数据发送到路由器上。

> 所以，不同网段的 计算机通信，都是现将 **数据报** 发送到路由器，再由路由器转发到其他网段。



# 网络协议

## ARP







## ICMP







## TCP/IP

### 三次握手

1. 建立连接通常由client发起。
2. 握手过程：
   1. 客户端向服务端发送SYN建链请求报文。
   2. 服务端收到消息后，向客户端发送ASK确认报文，完成客户端到服务端的链接建立。
   3. 服务端继续向客户端发送SYN建链请求报文，请求向客户端发送消息
   4. 客户端收到消息后，向服务暖发送ASK确认报文，完成服务端到客户端的链接建立。
3. 握手过程中2和3都是从服务端到客户端发送消息，故合并到一起。由此产生了三次握手。
4. TCP链接是双向链接，称之为全双工（单工：只能从一端到另一端；半双工：双端通信，但不能同时进行）。
5. 握手的目的：
   1. 为了确认双方的接收与发送能力是否正常。
   2. 指定自己的初始化序列号，为后面的可靠传送做准备。
   3. 如果是 https 协议的话，三次握手这个过程，还会进行数字证书的验证以及加密密钥的生成。



### 四次挥手

1. 断开连接可以由server和client发起。

2. 挥手过程：
   1. A端向B端发送FIN结束报文，等待关闭。
   2. B端收到FIN报文后，向A端发送ASK确认报文。A端到B端的链接关闭。
   3. B端向A端发送FIN结束报文，等待关闭。
   4. A端收到FIN报文后，向B端发送ASK确认报文。B端到A端的链接关闭。
3. 挥手过程中，A端到B端的链接断开后，B端仍然可以继续处理未完成的任务并继续给A端发送消息，并不会同步断开连接。因此断开连接是四次挥手。



## 网络模型

在因特网中，涉及两个或多个远程通信实体的所有活动都受协议的制约。

### 五层模型

为了给网络协议的设计提供一个结构，网络设计者以分层的方式组织协议和实现协议的硬件和软件。且每一层具有的协议被称为**协议栈**（protocol stack）。因特网地协议栈由五个层次组成，**自顶向下**(top-down)分别为：

#### 1. 应用层（软件）

- 应用层的分组称为**报文**。

- 应用层协议分布在多个端系统上，端系统之间的应用程序使用协议交换报文。

- 应用层包括许多协议：HTTP（WEB文档的请求和传送），SMTP（电子邮件），FTP（端系统间文件传送）。

#### 2. 传输层（软件）

* 运输层的分组称为**报文段**(segment)。
* 负责向两个主机中进程之间的通信提供服务,在应用程序端口之间运输应用层报文。

- 为上一层载荷套接端口信息。
- 两种运输协议：
- **TCP：**
  - 向应用程序提供面向连接的服务，包括应用层报文向目的地的准确传递和流量控制。
  - 通过三次握手，四次挥手建立或断开连接。可靠传输、速度相比UDP慢。
  - 将长报文划分为短报文。
  - 提供拥**塞控制机制**（网络拥塞时，抑制其传输速率）。
- **UDP：**
  - 向应用程序提供无连接式服务，不提供不必要服务。
  - 无可靠性，无流量控制和拥塞控制，速度快。

#### 3. 网络层（硬件软件混合）

+ 网络层的分组称为**数据报/数据包**（datagram）。

- 负责给分组提供不同主机之间提供通信服务。

- 协议：IP 网际协议，ICMP 控制报文协议，IGMP 组管理协议，ARP 地址解析协议，RARP反向地址转换协议
- ICMP 控制报文协议：主要用在主机与路由器之间传递控制信息，包括报告错误、交换受限控制和状态信息。
  + ping 用来测试网络可达性。
  + tracert 用来显示到达目的主机的路径。
- ARP 地址解析协议：**是网络层的协议，但是它所工作的内容是链路层的。**
- IGMP 组管理协议：是因特网协议家族中的一个组播协议。该协议运行在主机和组播路由器之间。
  - **单播(unicast):** 是指封包在计算机网络的传输中，目的地址为单一目标的一种传输方式。
  - **组播(multicast):** 也叫多播， 多点广播或群播。 指把信息同时传递给一组目的地址。它使用策略是最高效的，因为消息在每条网络链路上只需传递一次，而且只有在链路分叉的时候，消息才会被复制。
  - **广播(broadcast):**是指封包在计算机网络中传输时，目的地址为网络中所有设备的一种传输方式。实际上，这里所说的“所有设备”也是限定在一个范围之中，称为“广播域”。
- RARP反向地址转换协议：允许局域网的物理机器从[网关](https://baike.baidu.com/item/网关/98992)服务器的 ARP 表或者缓存上请求其 IP 地址。
- 为上一层载荷套接IP信息。

#### 4. 链路层（硬件)

- 链路层分组称为**帧**(frame)。
- ARP协议在这里工作，根据上一层header里面的IP解析出MAC地址，并套接。ARP协议还负责维护IP地址和MAC地址的映射关系，即ARP表项；同时还可以用来实现网段内重复IP的检测。
- 将分组从一个节点（主机或路由器）移动到路径上的下一个节点，网络层必须依靠链路层的服务。
- 两个主机之间的数据传输，总是在一段一段的链路上传送的，也就是说，在两个相邻结点之间传送数据是直接传送的(点对点)，这时就需要使用专门的链路层的协议。
- 链路层包括以太网，WiFi和电缆接入网的DOCSIS协议。

#### 5. 物理层

+ 物理层分组为**比特(bit)**。

- 物理层的任务是将链路层传递的帧中的一个个**比特**从一个节点移动到下一个节点，物理层协议依旧与链路相关，且与链路的实际传输媒体（网线、光纤）有关。





### OSI模型

OSI（Open System Interconnection)参考模型是国际标准化组织（ISO）制定地一个用于计算机或通信系统间互联地标准体系，一般被称为**OSI参考模型**或者**七层模型**。

OSI模型层是自底向上的，即第一层是物理层，第七层是应用层。

OSI模型自上而下分别为应用层、表示层、会话层、运输层、网络层、链路层和物理层。除了表示层和会话层，其他五层与因特网五层模型中地对应层功能相同，所以再补充以下表示层和会话层的功能。

#### 表示层

使通信的应用程序能够解释交换数据地含义，包括数据压缩，数据加密和数据描述。

#### 会话层

提供数据交换的定界和同步功能，包括建立检查点和恢复方案地方法。



#### 报文封装

**封装**(encapsulation)：

- 在发送主机端，一个**应用层报文**(application-layer message)被传送给传输层，传输层收到之后，在报文首部附上首部信息，这个首部信息会被接收端的传输层使用。应用层报文和运输层首部信息一起构成了**运输层报文段**(transport-layer segment)，也就是说运输层封装了应用层报文。

- 同理：运输层则向网络层传递报文段，网络层又类似地在其首部添加注入源和目的端系统地址等网络层首部信息，生成**网络层数据报**(network-layer-datagram)。

- 继续向下，数据包被传递给链路层，链路层继续加上链路层地首部信息，生成**链路层帧**(link-layer-frame)。

**总结**：

- 在每一层地分组都具有两种类型地字段：**首部字段**和**有效载荷字段**(payload field)，所谓<u>有效载荷就是上一层地分组</u>。
- 接收端反向对封装进行重构，一层一层去掉首部信息，以接收原信息。
- 分组：每一层封装并发送/接受包的大小是有限的，所以传输过程中会不断的分组成一个个数据单元来传输。



# 操作系统

## 基础概念

### 定义

操作系统位于应用软件和硬件设备之间，本质上也是一个软件，由系统内核(管理所有硬件资源)与系统接口(提供给程序员使用的接口)组成。

### 分类

- **多道操作系统：**多道技术的实现是为了解决多个程序竞争或者说共享同一个资源（比如cpu）的有序调度问题，以提高计算机硬件在时间和空间上的复用率。
  - **空间上的复用**：将内存分为几部分，每个部分放入一个程序，这样，同一时间内存中就有了多道程序。
  - **时间上的复用**：当一个程序在等待I/O时，可以切换到另一个程序继续使用cpu。
- **分时操作系统：**分时操作系统是使一台[计算机](https://baike.baidu.com/item/计算机/140338)采用[时间片轮转](https://baike.baidu.com/item/时间片轮转/7256857)的方式同时为几个、几十个甚至几百个用户服务的一种操作系统。
  - **时间片：**是把计算机的系统资源（尤其是 CPU时间）进行时间上的分割，每个时间段称为一个时间片，每个进程依次轮流使用时间片（5ms - 800ms）。
- **实时操作系统：**实时操作系统（RTOS）是指当外界事件或数据产生时，能够接受并以足够快的速度予以处理，其处理的结果又能在规定的时间之内来控制生产过程或对处理系统做出快速响应，调度一切可利用的资源完成实时任务，并控制所有实时任务协调一致运行的操作系统。提供及时响应和高可靠性是其主要特点。

- 编程相关概念：
  - **进程：** 进程就是运行中的程序。
    - 需要占用计算机物理资源，程序启动时，由操作系统调度分配。
    - 是计算机中最小的资源分配单位。即想要分配计算机的物理资源，至少得是一个完整的进程。
    - 进程创建时都有一个唯一标识PID。
    - 进程之间可以共用CPU资源；但内存资源是严格区分并隔离，互不干扰。父子进程间亦是如此。
    - 父进程负责开启和回收子进程的资源。
  - **线程：**是操作系统能够进行运算调度的最小单位。
    - 它被包含在进程之中，是进程中的实际运作单位。可以理解进程是CPU为程序分配了一间办公室，而线程才是办公室中真正干活的，所以线程之间是共享进程资源的。
    - 计算机具体执行编译后的计算机指令就是在线程中进行。
    - 一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。一个进程中至少有一个线程。
  - **同步：**
    - 在做A事件的时候，发起B事件，必须等待B事件完成之后才能继续执行A事件。
  - **异步：**
    - 在做A事件的时候，发起B事件，不必等待B事件完成，而同时执行A事件。
  - **并发：**
    - 在单一的CPU上，同时运行多个计算机程序。
    - 宏观上：多个程序是同时运行的。
    - 微观上：多个程序在CPU上按时间片的时间轮流执行，本质上是串行。
  - **并行：**
    - 多个CPU同时运行多个程序，互不干扰。
  - **阻塞：**
    - 进程占用CPU，但是CPU并没有进行运算工作。
  - **非阻塞：**
    - 进程占用CPU，CPU在进行运算工作。
  - **同步阻塞：**
    - 调用一个操作时，需要等待执行结果，在这个过程中CPU处于空闲状态。
    - 场景：input、sleep、本地IO、网络IO、网络编程中的recv、recvfrom等。
  - **同步非阻塞：**
    - 调用一个操作时，需要等待执行结果，在这个过程中CPU处于工作状态。
    - 场景：eval("1+2+3")、等待函数执行结果。
  - **异步非阻塞：**
    - 调用一个操作时，不需要等待执行结果，过程中CPU切换到其他程序继续工作，等当前操作执行完成时再切换回来。
    - 场景：进程、线程、协程的并发。
  - **异步阻塞：**
    - 调用多个异步操作，需要等待执行结果，但是不明确要等待哪个操作的结果，CPU在调用操作完成后处于空闲状态。
    - 场景：并发场景下等待IO操作等。



## 进程

### 进程状态

在三态模型中，进程状态分为三个基本状态，即运行态，就绪态，阻塞态。在五态模型中，进程分为新建态、终止态，运行态，就绪态，阻塞态。

- **新建态：**新建态对应于进程刚刚被创建的状态，创建1个进程要通过两个步骤，首先，是为一个新进程创建必要的管理信息；然后，让该进程进入就绪态。此时进程将处于新建态，它并没有被提交执行，而是在等待操作系统完成创建进程的必要操作。
- **终止态：**进程的终止也要通过两个步骤，首先，是等待操作系统进行善后；然后，退出主存。进入终止态的进程以后不再执行，但依然保留在操作系统中等待善后。一旦其他进程完成了对终止态进程的信息抽取之后，操作系统将删除该进程。
- **运行态：**进程占有处理器正在运行。
- **就绪态：**进程具备运行条件，等待系统分配处理器以便运行。
- **阻塞态：**指进程不具备运行条件，正在等待某个事件的完成，比如I/O阻塞时的状态。

​	<img src="./images/operationsystem_001.png" style="float: left; dispaly: block;">













### 进程调度

- **先来先服务(FCFS)调度算法：**每次调度是从就绪队列中选择一个最先进入该队列的进程，为之分配处理机，使之投入运行。该进程一直运行到完成或发生某事件而阻塞后才放弃处理机。
- **短任务优先(SPN)：**从就绪就绪队列中选出下一个“CPU执行期最短”的进程，为之分配[处理机](http://baike.baidu.com/view/2107226.htm)。
- **时间片轮转法：**从就绪队列中依次执行进行，执行时间为一个时间片。
- **多级反馈队列调度算法：**用户体验更好。
  - 设置多个就绪队列，并为各个队列赋予不同的优先级。在优先权越高的队列中， 为每个进程所规定的执行时间片就越小。
  - 当一个新进程进入内存后，首先放入第一队列的末尾，按FCFS原则排队等候调度。
  - 仅当第一队列空闲时，调度程序才调度第二队列中的进程运行。如果此时有新进程进入第一队列，则会立即终止当前运行中的第二队列进程，去执行第一队列的进程。



### 进程通讯

> 进程间通信（IPC，InterProcess Communication）是指在不同进程之间传播或交换信息。

- **管道：**管道可以分为两类：匿名管道和命名管道。

  - 常见的Linux命令 "|" 其实就是匿名管道，表示把一个进程的输出传输到另外一个进程，如：

    ```shell
    echo "Happyjava" | awk -F 'j' '{print $2}'
    # 输出 ava
    ```

  - 另外，我们可以通过 mkfifo <pipename> 命令创建一个命名管道，如：

    ```shell
    mkfifo pipe
    # 一个进程往管道输入数据，则会阻塞等待别的进程从管道读取数据：
    # 如果我另外一个窗口没有执行 cat < pipe 命令，则左边的窗口（echo 'Happyjava' > pipe）会一直阻塞。
    ```

- **共享内存：**系统加载一个进程的时候，分配给进程的内存并不是实际物理内存，而是虚拟内存空间。那么我们可以让两个进程各自拿出一块虚拟地址空间来，然后映射到相同的物理内存中，这样，两个进程虽然有着独立的虚拟内存空间，但有一部分却是映射到相同的物理内存，这就完成了内存共享机制了。

- **信号量：**信号量的本质就是一个计数器，用来实现进程之间的互斥与同步。例如信号量的初始值是 1，然后 a 进程来访问**内存1**的时候，我们就把信号量的值设为 0，然后进程b 也要来访问**内存1**的时候，看到信号量的值为 0 就知道已经有进程在访问**内存1**了，这个时候进程 b 就会访问不了**内存1**。

- **socket：**基于socket实现进程间的通信。

- **消息中间件：**基于网络通信实现，常见的中间件：memchace、redis、rabbitmq、kafka等。

- **消息队列：**是消息的链接表，存放在内核中。一个消息队列由一个标识符（即队列ID）来标识。
  - 消息队列是面向记录的，其中的消息具有特定的格式以及特定的优先级。
  - 消息队列独立于发送与接收进程。进程终止时，消息队列及其内容并不会被删除。
  - 消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取，也可以按消息的类型读取。



## I/O模式

有道云笔记：[IO模式](https://note.youdao.com/s/TLtzcC5e)





